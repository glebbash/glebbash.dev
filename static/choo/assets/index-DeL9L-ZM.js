var Us=Object.defineProperty;var Ks=(e,t,i)=>t in e?Us(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Li=(e,t,i)=>Ks(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const Hs=!0,Xs=.5;let Rt=!0,Ui="Escape",yt=!1,Dt=[],At=!1,Ct=!1,Et=!1,Vt=!1,Ke,Qt;function x(e,t){t?console.assert(e,t):console.assert(e)}function It(e,t=h(),i="#fff",s=0,n=0,a=!1){x(typeof i=="string","pass in css color strings"),Dt.push({pos:e,size:h(t),color:i,time:new oe(s),angle:n,fill:a})}function He(e,t=0,i="#fff",s=0,n=!1){x(typeof i=="string","pass in css color strings"),Dt.push({pos:e,size:t,color:i,time:new oe(s),angle:0,fill:n})}function ei(e,t,i,s){It(e,void 0,t,i,s)}function xe(e,t,i,s=.1,n){const a=h((t.x-e.x)/2,(t.y-e.y)/2),o=h(s,a.length()*2);It(e.add(a),o,i,n,a.angle(),!0)}function Xe(e,t,i,s,n){const a=h(J(e.x-t.x/2,i.x-s.x/2),J(e.y-t.y/2,i.y-s.y/2)),o=h(ut(e.x+t.x/2,i.x+s.x/2),ut(e.y+t.y/2,i.y+s.y/2));It(a.lerp(o,.5),o.subtract(a),n)}function Ki(e,t,i=1,s="#fff",n=0,a=0,o="monospace"){x(typeof s=="string","pass in css color strings"),Dt.push({text:e,pos:t,size:i,color:s,time:new oe(n),angle:a,font:o})}function Ys(){Dt=[]}function Hi(e,t=Wt,i="image/png"){Js(e.toDataURL(i),t)}function Js(e,t){Qt.download=t,Qt.href=e,Qt.click()}function qs(){document.body.appendChild(Qt=document.createElement("a")),Qt.style.display="none"}function ji(){it(Ui)&&(yt=!yt),yt&&(it("Digit0")&&(Rt=!Rt),it("Digit1")&&(At=!At,Et=!1),it("Digit2")&&(Et=!Et,At=!1),it("Digit3")&&(Vt=!Vt),it("Digit4")&&(Ct=!Ct),it("Digit5")&&(Ke=1))}function Zs(){if(Gt(A),Ke){Gt(A,!0),A.drawImage(F,0,0),F.width|=0;const e=S.width,t=S.height;u.fillRect(0,0,e,t),u.drawImage(S,0,0),Hi(F),Ke=0}if(Vt&&Le&&navigator.getGamepads){const e=navigator.getGamepads();for(let t=e.length;t--;){const i=e[t];if(i){const a=U,o=vt[t];for(let l=o.length;l--;){const r=a.add(h(l*1*2,t*1*3)),c=r.add(o[l].scale(1));He(r,1,"#fff7",0,!0),xe(r,c,"#f00"),ei(c,"#f00")}for(let l=i.buttons.length;l--;){const r=a.add(h(l*.2*2,t*1*3-1-.2)),c=i.buttons[l].pressed;He(r,.2,c?"#f00":"#fff7",0,!0),Ki(""+l,r,.2)}}}}if(yt){const e=A;A=u;const t=Bn();It(U,t.subtract(h(.1)),"#f008");let i=1/0,s;for(const n of B){if(n.canvas||n.destroyed||!n.size.x||!n.size.y)continue;const a=ft.distanceSquared(n.pos);a<i&&(i=a,s=n);const o=h(ut(n.size.x,.2),ut(n.size.y,.2)),l=new b(n.collideTiles?1:0,n.collideSolidObjects?1:0,n.isSolid?1:0,n.parent?.2:.5),r=n.parent?new b(1,1,1,.5):new b(0,0,0,.8);wt(n.pos,o,l,n.angle,!1),wt(n.pos,o.scale(.8),r,n.angle,!1),n.parent&&Ye(n.pos,n.parent.pos,.1,new b(0,0,1,.5),!1)}if(s){const n=gs(s.pos,ft);n&&wt(n.floor().add(h(.5)),h(1),new b(0,1,1,.3)),wt(ft.floor().add(h(.5)),h(1),new b(0,0,1,.5),0,!1),Ye(ft,s.pos,.1,n?new b(1,0,0,.5):new b(0,1,0,.5),!1);const a="mouse pos = "+ft+`
mouse collision = `+Di(ft)+`

--- object info ---
`+s.toString();_t(a,Xt,24,new b,.05,void 0,"center","monospace")}Gt(A=e)}{u.lineWidth=2;const e=Xs*E;Dt.forEach(t=>{u.save();const i=kt(t.pos);if(u.translate(i.x|0,i.y|0),u.rotate(t.angle),u.fillStyle=u.strokeStyle=t.color,t.text!=null)u.font=t.size*E+"px "+t.font,u.textAlign="center",u.textBaseline="middle",u.fillText(t.text,0,0);else if(t.size==0||t.size.x===0&&t.size.y===0)u.fillRect(-e/2,-1,e,3),u.fillRect(-1,-e/2,3,e);else if(t.size.x!=null){const s=t.size.x*E|0,n=t.size.y*E|0;t.fill&&u.fillRect(-s/2|0,-n/2|0,s,n),u.strokeRect(-s/2|0,-n/2|0,s,n)}else u.beginPath(),u.arc(0,0,t.size*E,0,9),t.fill&&u.fill(),u.stroke();u.restore()}),Dt=Dt.filter(t=>t.time<0)}{u.save(),u.fillStyle="#fff",u.textAlign="left",u.textBaseline="top",u.font="28px monospace",u.shadowColor="#000",u.shadowBlur=9;let e=9,t=-20,i=30;if(yt){u.fillText(Wt,e,t+=i),u.fillText("Objects: "+B.length,e,t+=i),u.fillText("Time: "+Ji(_),e,t+=i),u.fillText("---------",e,t+=i),u.fillStyle="#f00",u.fillText("ESC: Debug Overlay",e,t+=i),u.fillStyle=At?"#f00":"#fff",u.fillText("1: Debug Physics",e,t+=i),u.fillStyle=Et?"#f00":"#fff",u.fillText("2: Debug Particles",e,t+=i),u.fillStyle=Vt?"#f00":"#fff",u.fillText("3: Debug Gamepads",e,t+=i),u.fillStyle=Ct?"#f00":"#fff",u.fillText("4: Debug Raycasts",e,t+=i),u.fillStyle="#fff",u.fillText("5: Save Screenshot",e,t+=i);let s="";for(const a in C[0])X(a,0)&&(s+=a+" ");s&&u.fillText("Keys Down: "+s,e,t+=i);let n="";if(C[1])for(const a in C[1])X(a,1)&&(n+=a+" ");n&&u.fillText("Gamepad: "+n,e,t+=i)}else u.fillText(At?"Debug Physics":"",e,t+=i),u.fillText(Et?"Debug Particles":"",e,t+=i),u.fillText(Ct?"Debug Raycasts":"",e,t+=i),u.fillText(Vt?"Debug Gamepads":"",e,t+=i);u.restore()}}const T=Math.PI;function G(e){return Math.abs(e)}function J(e,t){return Math.min(e,t)}function ut(e,t){return Math.max(e,t)}function ht(e){return Math.sign(e)}function Vs(e,t=1){return(e%t+t)%t}function D(e,t=0,i=1){return e<t?t:e>i?i:e}function Y(e,t,i){return i-t?D((e-t)/(i-t)):0}function St(e,t,i){return t+D(e)*(i-t)}function ii(e,t,i=1){const s=(e-t)%i;return s*2%i-s}function Xi(e,t,i,s=1){return i+D(e)*ii(t,i,s)}function Qs(e,t){return ii(e,t,2*T)}function $s(e,t,i){return Xi(e,t,i,2*T)}function tn(e){return e*e*(3-2*e)}function en(e){return 2**Math.ceil(Math.log2(e))}function Se(e,t,i,s=h()){return G(e.x-i.x)*2<t.x+s.x&&G(e.y-i.y)*2<t.y+s.y}function Yi(e=1,t=1,i=_){return t/2*(1-Math.cos(i*e*2*T))}function Ji(e){return(e/60|0)+":"+(e%60<10?"0":"")+(e%60|0)}function I(e=1,t=0){return t+Math.random()*(e-t)}function Me(e,t=0){return Math.floor(I(e,t))}function qi(){return Me(2)*2-1}function si(e=1){return new M().setAngle(I(2*T),e)}function Zi(e=1,t=0){return e>0?si(e*I(t/e,1)**.5):new M}function be(e=new b,t=new b(0,0,0,1),i=!1){return i?e.lerp(t,I()):new b(I(e.r,t.r),I(e.g,t.g),I(e.b,t.b),I(e.a,t.a))}class sn{constructor(t){this.seed=t}float(t=1,i=0){return this.seed^=this.seed<<13,this.seed^=this.seed>>>17,this.seed^=this.seed<<5,i+(t-i)*G(this.seed%1e9)/1e9}int(t,i=0){return Math.floor(this.float(t,i))}sign(){return this.int(2)*2-1}}function h(e=0,t){return typeof e=="number"?new M(e,t??e):new M(e.x,e.y)}function W(e){return e instanceof M}class M{constructor(t=0,i=0){this.x=t,this.y=i}copy(){return new M(this.x,this.y)}add(t){return x(W(t)),new M(this.x+t.x,this.y+t.y)}subtract(t){return x(W(t)),new M(this.x-t.x,this.y-t.y)}multiply(t){return x(W(t)),new M(this.x*t.x,this.y*t.y)}divide(t){return x(W(t)),new M(this.x/t.x,this.y/t.y)}scale(t){return x(!W(t)),new M(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return x(W(t)),this.distanceSquared(t)**.5}distanceSquared(t){return x(W(t)),(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const i=this.length();return i?this.scale(t/i):new M(0,t)}clampLength(t=1){const i=this.length();return i>t?this.scale(t/i):this}dot(t){return x(W(t)),this.x*t.x+this.y*t.y}cross(t){return x(W(t)),this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,i=1){return this.x=i*Math.sin(t),this.y=i*Math.cos(t),this}rotate(t){const i=Math.cos(t),s=Math.sin(t);return new M(this.x*i-this.y*s,this.x*s+this.y*i)}setDirection(t,i=1){return x(t==0||t==1||t==2||t==3),h(t%2?t-1?-i:i:0,t%2?0:t?-i:i)}direction(){return G(this.x)>G(this.y)?this.x<0?3:1:this.y<0?2:0}invert(){return new M(this.y,-this.x)}floor(){return new M(Math.floor(this.x),Math.floor(this.y))}area(){return G(this.x*this.y)}lerp(t,i){return x(W(t)),this.add(t.subtract(this).scale(D(i)))}arrayCheck(t){return x(W(t)),this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}function nn(e,t,i,s){return new b(e,t,i,s)}function lt(e,t,i,s){return new b().setHSLA(e,t,i,s)}function Jt(e){return e instanceof b}class b{constructor(t=1,i=1,s=1,n=1){this.r=t,this.g=i,this.b=s,this.a=n}copy(){return new b(this.r,this.g,this.b,this.a)}add(t){return x(Jt(t)),new b(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return x(Jt(t)),new b(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return x(Jt(t)),new b(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return x(Jt(t)),new b(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,i=t){return new b(this.r*t,this.g*t,this.b*t,this.a*i)}clamp(){return new b(D(this.r),D(this.g),D(this.b),D(this.a))}lerp(t,i){return x(Jt(t)),this.add(t.subtract(this).scale(D(i)))}setHSLA(t=0,i=0,s=1,n=1){const a=s<.5?s*(1+i):s+i-s*i,o=2*s-a,l=(r,c,f)=>(f=(f%1+1)%1)<1/6?r+(c-r)*6*f:f<1/2?c:f<2/3?r+(c-r)*(2/3-f)*6:r;return this.r=l(o,a,t+1/3),this.g=l(o,a,t),this.b=l(o,a,t-1/3),this.a=n,this}getHSLA(){const t=D(this.r),i=D(this.g),s=D(this.b),n=D(this.a),a=Math.max(t,i,s),o=Math.min(t,i,s),l=(a+o)/2;let r=0,c=0;if(a!=o){let f=a-o;c=l>.5?f/(2-a-o):f/(a+o),t==a?r=(i-s)/f+(i<s?6:0):i==a?r=(s-t)/f+2:s==a&&(r=(t-i)/f+4)}return[r/6,c,l,n]}mutate(t=.05,i=0){return new b(this.r+I(t,-t),this.g+I(t,-t),this.b+I(t,-t),this.a+I(i,-i)).clamp()}toString(t=!0){const i=s=>((s=s*255|0)<16?"0":"")+s.toString(16);return"#"+i(this.r)+i(this.g)+i(this.b)+(t?i(this.a):"")}setHex(t){const i=s=>D(parseInt(t.slice(s,s+2),16)/255);return this.r=i(1),this.g=i(3),this.b=i(5),this.a=t.length>7?i(7):1,this}rgbaInt(){const t=D(this.r)*255|0,i=D(this.g)*255<<8,s=D(this.b)*255<<16,n=D(this.a)*255<<24;return t+i+s+n}}class oe{constructor(t){this.time=t==null?void 0:_+t,this.setTime=t}set(t=0){this.time=_+t,this.setTime=t}unset(){this.time=void 0}isSet(){return this.time!=null}active(){return _<=this.time}elapsed(){return _>this.time}get(){return this.isSet()?_-this.time:0}getPercent(){return this.isSet()?Y(this.time-_,this.setTime,0):0}toString(){return this.isSet()?Math.abs(this.get())+" seconds "+(this.get()<0?"before":"after"):"unset"}valueOf(){return this.get()}}let U=h(),E=32,we=h(1920,1200),$t=h(),re=!0,ni="arial",ai=!1,q=!0,le=!0,Oe=h(16),bt=.1,oi=!0,ri=1,li=1,ci=1,hi=0,ui=.8,Ot=1,Lt=0,ve=1,Le=!0,di=!0,te=!0,ie=!1,je=!0,O=99,fi=.3,gi=!0,at=!0,Kt=.5,mi=40,yi=.7,Te=5,jt=.5,Ft=h(640,80),ee=50,pi=!1;function Vi(e){U=e}function Qi(e){E=e}function an(e){we=e}function $i(e){$t=e}function on(e){re=e}function rn(e){ni=e}function ln(e){ai=e}function cn(e){q=e}function hn(e){le=e}function un(e){Oe=e}function dn(e){bt=e}function fn(e){oi=e}function gn(e){ri=e}function mn(e){li=e}function yn(e){ci=e}function pn(e){hi=e}function xn(e){ui=e}function Sn(e){Ot=e}function bn(e){Lt=e}function wn(e){ve=e}function vn(e){Le=e}function Tn(e){di=e}function Dn(e){te=e}function ts(e){ie=e}function An(e){je=e}function es(e){O=e}function Cn(e){fi=e}function En(e){gi=e}function zn(e){at=e}function Pn(e){Kt=e}function Rn(e){mi=e}function In(e){yi=e}function kn(e){Te=e}function Mn(e){jt=e}function On(e){Ft=e}function Ln(e){ee=e}function jn(e){pi=e}function is(e){Rt=e}function Fn(e){Ui=e}class ce{constructor(t=h(),i=h(1),s,n=0,a,o=0){x(W(t)&&W(i),"ensure pos and size are vec2s"),x(typeof s!="number"||!s,"old style tile setup"),this.pos=t.copy(),this.size=i,this.drawSize=void 0,this.tileInfo=s,this.angle=n,this.color=a,this.additiveColor=void 0,this.mirror=!1,this.mass=ri,this.damping=li,this.angleDamping=ci,this.elasticity=hi,this.friction=ui,this.gravityScale=1,this.renderOrder=o,this.velocity=h(),this.angleVelocity=0,this.spawnTime=_,this.children=[],this.parent=void 0,this.localPos=h(),this.localAngle=0,this.collideTiles=!1,this.collideSolidObjects=!1,this.isSolid=!1,B.push(this)}update(){const t=this.parent;if(t){this.pos=this.localPos.multiply(h(t.getMirrorSign(),1)).rotate(-t.angle).add(t.pos),this.angle=t.getMirrorSign()*this.localAngle+t.angle;return}this.velocity.x=D(this.velocity.x,-Ot,Ot),this.velocity.y=D(this.velocity.y,-Ot,Ot);const i=this.pos.copy();if(this.velocity.y+=Lt*this.gravityScale,this.pos.x+=this.velocity.x*=this.damping,this.pos.y+=this.velocity.y*=this.damping,this.angle+=this.angleVelocity*=this.angleDamping,x(this.angleDamping>=0&&this.angleDamping<=1),x(this.damping>=0&&this.damping<=1),!oi||!this.mass)return;const s=this.velocity.y<0;if(this.groundObject){const n=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=n+(this.velocity.x-n)*this.friction,this.groundObject=0}if(this.collideSolidObjects)for(const a of Is){if(!this.isSolid&&!a.isSolid||a.destroyed||a.parent||a==this||!Se(this.pos,this.size,a.pos,a.size))continue;const o=this.collideWithObject(a),l=a.collideWithObject(this);if(!o||!l)continue;if(Se(i,this.size,a.pos,a.size)){const w=i.subtract(a.pos),d=w.length(),m=.001,v=d<.01?si(m):w.scale(m/d);this.velocity=this.velocity.add(v),a.mass&&(a.velocity=a.velocity.subtract(v)),yt&&At&&Xe(this.pos,this.size,a.pos,a.size,"#f00");continue}const r=this.size.add(a.size),c=(i.y-a.pos.y)*2>r.y+Lt,f=G(i.y-a.pos.y)*2<r.y,g=G(i.x-a.pos.x)*2<r.x,p=ut(this.elasticity,a.elasticity);if(c||g||!f){if(this.pos.y=a.pos.y+(r.y/2+.001)*ht(i.y-a.pos.y),a.groundObject&&s||!a.mass)s&&(this.groundObject=a),this.velocity.y*=-p;else if(a.mass){const w=(this.mass*this.velocity.y+a.mass*a.velocity.y)/(this.mass+a.mass),d=this.velocity.y*(this.mass-a.mass)/(this.mass+a.mass)+a.velocity.y*2*a.mass/(this.mass+a.mass),m=a.velocity.y*(a.mass-this.mass)/(this.mass+a.mass)+this.velocity.y*2*this.mass/(this.mass+a.mass);this.velocity.y=St(p,w,d),a.velocity.y=St(p,w,m)}}if(!c&&f)if(this.pos.x=a.pos.x+(r.x/2+.001)*ht(i.x-a.pos.x),a.mass){const w=(this.mass*this.velocity.x+a.mass*a.velocity.x)/(this.mass+a.mass),d=this.velocity.x*(this.mass-a.mass)/(this.mass+a.mass)+a.velocity.x*2*a.mass/(this.mass+a.mass),m=a.velocity.x*(a.mass-this.mass)/(this.mass+a.mass)+this.velocity.x*2*this.mass/(this.mass+a.mass);this.velocity.x=St(p,w,d),a.velocity.x=St(p,w,m)}else this.velocity.x*=-p;yt&&At&&Xe(this.pos,this.size,a.pos,a.size,"#f0f")}if(this.collideTiles&&qt(this.pos,this.size,this)&&!qt(i,this.size,this)){const n=qt(h(i.x,this.pos.y),this.size,this),a=qt(h(this.pos.x,i.y),this.size,this);if(n||!a){this.groundObject=s,this.velocity.y*=-this.elasticity;const o=(i.y-this.size.y/2|0)-(i.y-this.size.y/2);o<0&&o>this.damping*this.velocity.y+Lt*this.gravityScale&&(this.velocity.y=this.damping?(o-Lt*this.gravityScale)/this.damping:0),this.pos.y=i.y}a&&(this.pos.x=i.x,this.velocity.x*=-this.elasticity)}}render(){Nt(this.pos,this.drawSize||this.size,this.tileInfo,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy(t.parent=0)}}collideWithTile(t,i){return t>0}collideWithTileRaycast(t,i){return t>0}collideWithObject(t){return!0}getAliveTime(){return _-this.spawnTime}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyForce(t){this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,i=h(),s=0){x(!t.parent&&!this.children.includes(t)),this.children.push(t),t.parent=this,t.localPos=i.copy(),t.localAngle=s}removeChild(t){x(t.parent==this&&this.children.includes(t)),this.children.splice(this.children.indexOf(t),1),t.parent=0}setCollision(t=!0,i=!0,s=!0){x(t||!i,"solid objects must be set to collide"),this.collideSolidObjects=t,this.isSolid=i,this.collideTiles=s}toString(){{let t="type = "+this.constructor.name;return(this.pos.x||this.pos.y)&&(t+=`
pos = `+this.pos),(this.velocity.x||this.velocity.y)&&(t+=`
velocity = `+this.velocity),(this.size.x||this.size.y)&&(t+=`
size = `+this.size),this.angle&&(t+=`
angle = `+this.angle.toFixed(3)),this.color&&(t+=`
color = `+this.color),t}}}let S,A,F,u,R=h(),Ht=[],De;function se(e=h(),t=Oe,i=0){if(typeof t=="number"&&(x(t>0),t=h(t)),typeof e=="number"){const s=Ht[i];x(s,"Texture not loaded");const n=s.size.x/t.x|0;e=h(e%n*t.x,(e/n|0)*t.y)}return new Fe(e,t,i)}class Fe{constructor(t=h(),i=Oe,s=0){this.pos=t,this.size=i,this.textureIndex=s}offset(t){return new Fe(this.pos.add(t),this.size,this.textureIndex)}getTextureInfo(){return Ht[this.textureIndex]}}class ss{constructor(t){this.image=t,this.size=h(t.width,t.height),this.glTexture=q&&Ei(t),this.fixBleedSize=h(bt).divide(this.size)}}function xi(e){return new M((e.x-R.x/2+.5)/E+U.x,(e.y-R.y/2+.5)/-E+U.y)}function kt(e){return new M((e.x-U.x)*E+R.x/2-.5,(e.y-U.y)*-E+R.y/2-.5)}function Bn(){return R.scale(1/E)}function Nt(e,t=h(1),i,s=new b,n=0,a,o=new b(0,0,0,0),l=q,r,c){x(!c||!l,"context only supported in canvas 2D mode"),x(typeof i!="number"||!i,"this is an old style calls, to fix replace it with tile(tileIndex, tileSize)");const f=i&&i.getTextureInfo();if(l)if(r&&(e=xi(e),t=t.scale(1/E)),f){const g=i.pos.x/f.size.x,p=i.pos.y/f.size.y,w=i.size.x/f.size.x,d=i.size.y/f.size.y,m=f.fixBleedSize;bs(f.glTexture),Gi(e.x,e.y,a?-t.x:t.x,t.y,n,g+m.x,p+m.y,g-m.x+w,p-m.y+d,s.rgbaInt(),o.rgbaInt())}else Gi(e.x,e.y,t.x,t.y,n,0,0,0,0,0,s.rgbaInt());else Rt&&++De,ns(e,t,n,a,g=>{if(f){const p=i.pos.x+bt,w=i.pos.y+bt,d=i.size.x-2*bt,m=i.size.y-2*bt;g.globalAlpha=s.a,g.drawImage(f.image,p,w,d,m,-.5,-.5,1,1),g.globalAlpha=1}else g.fillStyle=s,g.fillRect(-.5,-.5,1,1)},r,c)}function wt(e,t,i,s,n,a,o){Nt(e,t,void 0,i,s,!1,void 0,n,a,o)}function Ye(e,t,i=.1,s,n,a,o){const l=h((t.x-e.x)/2,(t.y-e.y)/2),r=h(i,l.length()*2);wt(e.add(l),r,s,l.angle(),n,a,o)}function ns(e,t,i,s,n,a,o=A){a||(e=kt(e),t=t.scale(E)),o.save(),o.translate(e.x+.5,e.y+.5),o.rotate(i),o.scale(s?-t.x:t.x,t.y),n(o),o.restore()}function Je(e,t=q,i){x(!i||!t,"context only supported in canvas 2D mode"),t?_e=e:(i||(i=A),i.globalCompositeOperation=e?"lighter":"source-over")}function _n(e,t,i=1,s,n=0,a,o,l,r){_t(e,kt(t),i*E,s,n*E,a,o,l,r)}function _t(e,t,i=1,s=new b,n=0,a=new b(0,0,0),o="center",l=ni,r=u){r.fillStyle=s.toString(),r.lineWidth=n,r.strokeStyle=a.toString(),r.textAlign=o,r.font=i+"px "+l,r.textBaseline="middle",r.lineJoin="round",t=t.copy(),(e+"").split(`
`).forEach(c=>{n&&r.strokeText(c,t.x,t.y),r.fillText(c,t.x,t.y),t.y+=i})}let me;class Gn{constructor(t,i=h(8),s=h(0,1),n=u){me||((me=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=t||me,this.tileSize=i,this.paddingSize=s,this.context=n}drawText(t,i,s=1,n){this.drawTextScreen(t,kt(i).floor(),s*E|0,n)}drawTextScreen(t,i,s=4,n){const a=this.context;a.save(),a.imageSmoothingEnabled=!re;const o=this.tileSize,l=o.add(this.paddingSize).scale(s),r=this.image.width/this.tileSize.x|0;(t+"").split(`
`).forEach((c,f)=>{const g=n?c.length*o.x*s/2|0:0;for(let p=c.length;p--;){let w=c[p].charCodeAt(0);(w<32||w>127)&&(w=127);const d=w-32,m=d%r,v=d/r|0,P=i.add(h(p,f).multiply(l));a.drawImage(this.image,m*o.x,v*o.y,o.x,o.y,P.x-g,P.y,o.x*s,o.y*s)}}),a.restore()}}function as(){return!!document.fullscreenElement}function os(){as()?document.exitFullscreen&&document.exitFullscreen():document.body.requestFullscreen&&document.body.requestFullscreen()}function X(e,t=0){return x(t>0||typeof e!="number"||e<3,"use code string for keyboard"),C[t]&&!!(C[t][e]&1)}function it(e,t=0){return x(t>0||typeof e!="number"||e<3,"use code string for keyboard"),C[t]&&!!(C[t][e]&2)}function Si(e,t=0){return x(t>0||typeof e!="number"||e<3,"use code string for keyboard"),C[t]&&!!(C[t][e]&4)}function bi(){C=[[]]}const Nn=X,Wn=it,Un=Si;let ft=h(),Xt=h(),wi=0,nt=!1,Kn=!1;function rt(e,t=0){return X(e,t+1)}function rs(e,t=0){return it(e,t+1)}function Hn(e,t=0){return Si(e,t+1)}function ls(e,t=0){return vt[t]&&vt[t][e]||h()}let C=[[]];function Fi(){ue||document.hasFocus()||bi(),ft=xi(Xt),cs()}function Bi(){for(const e of C)for(const t in e)e[t]&=1;wi=0}{let e=function(t){return te?t=="KeyW"?"ArrowUp":t=="KeyS"?"ArrowDown":t=="KeyA"?"ArrowLeft":t=="KeyD"?"ArrowRight":t:t};var Fa=e;onkeydown=t=>{t.target==document.body&&(t.repeat||(nt=!1,C[0][t.code]=3,te&&(C[0][e(t.code)]=3)))},onkeyup=t=>{t.target==document.body&&(C[0][t.code]=4,te&&(C[0][e(t.code)]=4))}}onmousedown=e=>{nt=!1,C[0][e.button]=3,Xt=he(e),e.button&&e.preventDefault()};onmouseup=e=>C[0][e.button]=C[0][e.button]&2|4;onmousemove=e=>Xt=he(e);onwheel=e=>wi=e.ctrlKey?0:ht(e.deltaY);oncontextmenu=e=>!1;function he(e){if(!S)return h();const t=S.getBoundingClientRect();return h(S.width,S.height).multiply(h(Y(e.x,t.left,t.right),Y(e.y,t.top,t.bottom)))}const vt=[];function cs(){if(ie&&ue&&(gt||Yn(),ne.isSet())){const t=vt[0]||(vt[0]=[]);t[0]=h(Tt.x,-Tt.y);const i=C[1]||(C[1]=[]);for(let s=10;s--;){const n=s==3?2:s==2?3:s;i[n]=gt[s]?rt(n,0)?1:3:rt(n,0)?4:0}}if(!Le||!navigator||!navigator.getGamepads)return;const e=navigator.getGamepads();for(let t=e.length;t--;){const i=e[t],s=C[t+1]||(C[t+1]=[]),n=vt[t]||(vt[t]=[]);if(i){const l=r=>r>.3?Y(r,.3,.8):r<-.3?-Y(-r,.3,.8):0;for(let r=0;r<i.axes.length-1;r+=2)n[r>>1]=h(l(i.axes[r]),l(-i.axes[r+1])).clampLength();for(let r=i.buttons.length;r--;){const c=i.buttons[r],f=rt(r,t);s[r]=c.pressed?f?1:3:f?4:0,nt||(nt=!t&&c.pressed)}if(di){const r=h((rt(15,t)&&1)-(rt(14,t)&&1),(rt(12,t)&&1)-(rt(13,t)&&1));r.lengthSquared()&&(n[0]=r.clampLength())}ie&&nt&&ne.unset()}}}function hs(e=100){gi&&navigator&&navigator.vibrate&&navigator.vibrate(e)}function Xn(){hs(0)}const ue=window.ontouchstart!==void 0;if(ue){let e;onmousedown=onmouseup=()=>0,ontouchstart=ontouchmove=ontouchend=t=>{at&&$&&$.state!="running"&&us(0);const i=t.touches.length,s=0;if(i){const n=h(t.touches[0].clientX,t.touches[0].clientY);Xt=he(n),e?nt=!1:C[0][s]=3}else e&&(C[0][s]=C[0][s]&2|4);return e=i,document.hasFocus()&&t.preventDefault(),!0}}let ne=new oe,gt,Tt;function Yn(){gt=[],Tt=h();const e=ontouchstart;ontouchstart=ontouchmove=ontouchend=t=>{if(Tt=h(),gt=[],t.touches.length&&(ne.set(),Ut)){gt[9]=1;return}const s=h(O,R.y-O),n=R.subtract(h(O,O)),a=R.scale(.5);for(const o of t.touches){const l=he(h(o.clientX,o.clientY));if(l.distance(s)<O)if(je)Tt=l.subtract(s).scale(2/O).clampLength();else{const r=l.subtract(s).angle();Tt.setAngle((r*4/T+8.5|0)*T/4)}else if(l.distance(n)<O){const r=l.subtract(n).direction();gt[r]=1}else l.distance(a)<O&&(gt[9]=1)}return e.bind(window)(t),nt=!0,!0}}function Jn(){if(!ie||!ne.isSet())return;const e=Y(ne.get(),4,3);if(!e||Ut)return;u.save(),u.globalAlpha=e*fi,u.strokeStyle="#fff",u.lineWidth=3,u.fillStyle=Tt.lengthSquared()>0?"#fff":"#000",u.beginPath();const t=h(O,R.y-O);if(je)u.arc(t.x,t.y,O/2,0,9),u.fill(),u.stroke();else{for(let s=10;s--;){const n=s*T/4;u.arc(t.x,t.y,O*.6,n+T/8,n+T/8),s%2&&u.arc(t.x,t.y,O*.33,n,n),s==1&&u.fill()}u.stroke()}const i=h(R.x-O,R.y-O);for(let s=4;s--;){const n=i.add(h().setDirection(s,O/2));u.fillStyle=gt[s]?"#fff":"#000",u.beginPath(),u.arc(n.x,n.y,O/4,0,9),u.fill(),u.stroke()}u.restore()}class Be{constructor(t,i=mi,s=yi){at&&(this.range=i,this.taper=s,this.randomness=0,t&&(this.randomness=t[1]||0,t[1]=0,this.sampleChannels=[Ti(...t)],this.sampleRate=de))}play(t,i=1,s=1,n=1,a=!1){if(!at||!this.sampleChannels)return;let o;if(t){const r=this.range;if(r){const c=U.distanceSquared(t);if(c>r*r)return;i*=Y(c**.5,r,r*this.taper)}o=kt(t).x*2/S.width-1}const l=s+s*this.randomness*n*I(-1,1);return this.source=vi(this.sampleChannels,i,l,o,a,this.sampleRate)}stop(){this.source&&this.source.stop(),this.source=void 0}getSource(){return this.source}playNote(t,i,s){return this.play(i,s,2**(t/12),0)}getDuration(){return this.sampleChannels&&this.sampleChannels[0].length/this.sampleRate}isLoading(){return!this.sampleChannels}}class qn extends Be{constructor(t,i=0,s,n){super(void 0,s,n),this.randomness=i,at&&fetch(t).then(a=>a.arrayBuffer()).then(a=>$.decodeAudioData(a)).then(a=>{this.sampleChannels=[];for(let o=a.numberOfChannels;o--;)this.sampleChannels[o]=Array.from(a.getChannelData(o));this.sampleRate=a.sampleRate})}}class Zn extends Be{constructor(t){super(void 0),at&&(this.randomness=0,this.sampleChannels=ea(...t),this.sampleRate=de)}playMusic(t,i=!1){return super.play(void 0,t,1,1,i)}}function Vn(e,t=1,i=!1){if(!at)return;const s=new Audio(e);return s.volume=Kt*t,s.loop=i,s.play(),s}function Qn(e,t="",i=1,s=1,n=1){if(!at||!speechSynthesis)return;const a=new SpeechSynthesisUtterance(e);return a.lang=t,a.volume=2*i*Kt,a.rate=s,a.pitch=n,speechSynthesis.speak(a),a}function $n(){speechSynthesis&&speechSynthesis.cancel()}function ta(e,t=220){return t*2**(e/12)}let $=new AudioContext,_i=!1;function vi(e,t=1,i=1,s=0,n=!1,a=de){if(!at)return;const o=_i;if((_i=$.state!="running")&&($.resume(),o))return;const l=$.createBuffer(e.length,e[0].length,a),r=$.createBufferSource();e.forEach((f,g)=>l.getChannelData(g).set(f)),r.buffer=l,r.playbackRate.value=i,r.loop=n;const c=$.createGain();return c.gain.value=Kt*t,c.connect($.destination),r.connect(new StereoPannerNode($,{pan:D(s,-1,1)})).connect(c),r.start(),r}function us(...e){return vi([Ti(...e)])}const de=44100;function Ti(e=1,t=.05,i=220,s=0,n=0,a=.1,o=0,l=1,r=0,c=0,f=0,g=0,p=0,w=0,d=0,m=0,v=0,P=1,L=0,V=0,H=0){let k=T*2,z=de,pt=r*=500*k/z/z,ot=i*=I(1+t,1-t)*k/z,dt=[],N=0,xt=0,j=0,Yt=1,js=0,Fs=0,tt=0,Ne,Mt,Bs=2,zi=k*G(H)*2/z,We=Math.cos(zi),Pi=Math.sin(zi)/2/Bs,fe=1+Pi,_s=-2*We/fe,Gs=(1-Pi)/fe,Ri=(1+ht(H)*We)/2/fe,Ns=-(ht(H)+We)/fe,Ws=Ri,Ii=0,ki=0,Mi=0,Oi=0;for(s=s*z+9,L*=z,n*=z,a*=z,v*=z,c*=500*k/z**3,d*=k/z,f*=k/z,g*=z,p=p*z|0,e*=Kt,Mt=s+L+n+a+v|0;j<Mt;dt[j++]=tt*e)++Fs%(m*100|0)||(tt=o?o>1?o>2?o>3?Math.sin(N**3):D(Math.tan(N),1,-1):1-(2*N/k%2+2)%2:1-4*G(Math.round(N/k)-N/k):Math.sin(N),tt=(p?1-V+V*Math.sin(k*j/p):1)*ht(tt)*G(tt)**l*(j<s?j/s:j<s+L?1-(j-s)/L*(1-P):j<s+L+n?P:j<Mt-v?(Mt-j-v)/a*P:0),tt=v?tt/2+(v>j?0:(j<Mt-v?1:(Mt-j)/v)*dt[j-v|0]/2/e):tt,H&&(tt=Oi=Ws*Ii+Ns*(Ii=ki)+Ri*(ki=tt)-Gs*Mi-_s*(Mi=Oi))),Ne=(i+=r+=c)*Math.cos(d*xt++),N+=Ne+Ne*w*Math.sin(j**5),Yt&&++Yt>g&&(i+=f,ot+=f,Yt=0),p&&!(++js%p)&&(i=ot,r=pt,Yt=Yt||1);return dt}function ea(e,t,i,s=125){let n,a,o,l,r,c,f,g,p,w,d,m,v,P=0,L,V=[],H=[],k=[],z=0,pt=0,ot=1,dt={},N=de/s*60>>2;for(;ot;z++)V=[ot=g=m=0],i.forEach((xt,j)=>{for(f=t[xt][z]||[0,0,0],ot|=t[xt][z]&&1,L=m+(t[xt][0].length-2-(g?0:1))*N,v=j==i.length-1,n=2,o=m;n<f.length+v;g=++n){for(r=f[n],p=n==f.length+v-1&&v||w!=(f[0]||0)||r|0,a=0;a<N&&g;a++>N-99&&p&&d<1?d+=1/99:0)c=(1-d)*V[P++]/2||0,H[o]=(H[o]||0)-c*pt+c,k[o]=(k[o++]||0)+c*pt+c;r&&(d=r%1,pt=f[1]||0,(r|=0)&&(V=dt[[w=f[P=0]||0,r]]=dt[[w,r]]||(l=[...e[w]],l[2]*=2**((r-12)/12),r>0?Ti(...l):[])))}m=L});return[H,k]}let zt=[],Z=h();function ds(e){Z=e,zt=[];for(let t=zt.length=Z.area();t--;)zt[t]=0}function fs(e,t=0){e.arrayCheck(Z)&&(zt[(e.y|0)*Z.x+e.x|0]=t)}function Di(e){return e.arrayCheck(Z)?zt[(e.y|0)*Z.x+e.x|0]:0}function qt(e,t=h(),i){const s=ut(e.x-t.x/2|0,0),n=ut(e.y-t.y/2|0,0),a=J(e.x+t.x/2,Z.x),o=J(e.y+t.y/2,Z.y);for(let l=n;l<o;++l)for(let r=s;r<a;++r){const c=zt[l*Z.x+r];if(c&&(!i||i.collideWithTile(c,h(r,l))))return!0}}function gs(e,t,i){const s=t.subtract(e),n=s.length(),a=s.normalize(),o=h(G(1/a.x),G(1/a.y));let r=e.floor(),c=o.x*(s.x<0?e.x-r.x:r.x-e.x+1),f=o.y*(s.y<0?e.y-r.y:r.y-e.y+1);for(;;){const g=Di(r);if(g&&(!i||i.collideWithTile(g,r)))return Ct&&xe(e,t,"#f00",.02),Ct&&ei(r.add(h(.5)),"#ff0"),r.add(h(.5));if(c>n&&f>n)break;c>f?(r.y+=ht(s.y),f+=o.y):(r.x+=ht(s.x),c+=o.x)}Ct&&xe(e,t,"#00f",.02)}class Ai{constructor(t,i=0,s=!1,n=new b){this.tile=t,this.direction=i,this.mirror=s,this.color=n}clear(){this.tile=this.direction=0,this.mirror=!1,this.color=new b}}class ms extends ce{constructor(t,i=Z,s=se(),n=h(1),a=0){super(t,i,s,0,void 0,a),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.scale=n,this.isOverlay=!1,this.data=[];for(let o=this.size.area();o--;)this.data.push(new Ai)}setData(t,i,s=!1){t.arrayCheck(this.size)&&(this.data[(t.y|0)*this.size.x+t.x|0]=i,s&&this.drawTileData(t))}getData(t){return t.arrayCheck(this.size)&&this.data[(t.y|0)*this.size.x+t.x|0]}update(){}render(){x(A!=this.context,"must call redrawEnd() after drawing tiles"),q&&!le&&!this.isOverlay&&Gt(A);const t=kt(this.pos.add(h(0,this.size.y*this.scale.y)));(this.isOverlay?u:A).drawImage(this.canvas,t.x,t.y,E*this.size.x*this.scale.x,E*this.size.y*this.scale.y)}redraw(){this.redrawStart(!0);for(let t=this.size.x;t--;)for(let i=this.size.y;i--;)this.drawTileData(h(t,i),!1);this.redrawEnd()}redrawStart(t=!1){this.savedRenderSettings=[S,A,R,U,E],S=this.canvas,A=this.context,R=this.size.multiply(this.tileInfo.size),U=this.size.scale(.5),E=this.tileInfo.size.x,t&&(S.width=R.x,S.height=R.y),Os()}redrawEnd(){x(A==this.context,"must call redrawStart() before drawing tiles"),q&&Gt(A,!0),[S,A,R,U,E]=this.savedRenderSettings}drawTileData(t,i=!0){const s=this.tileInfo.size;if(i){const a=t.multiply(s);this.context.clearRect(a.x,this.canvas.height-a.y,s.x,-s.y)}const n=this.getData(t);if(n.tile!=null){const a=this.pos.add(t).add(h(.5));x(A==this.context,"must call redrawStart() before drawing tiles");const o=se(n.tile,s,this.tileInfo.textureIndex);Nt(a,h(1),o,n.color,n.direction*T/2,n.mirror)}}drawCanvas2D(t,i,s,n,a){const o=this.context;o.save(),t=t.subtract(this.pos).multiply(this.tileInfo.size),i=i.multiply(this.tileInfo.size),o.translate(t.x,this.canvas.height-t.y),o.rotate(s),o.scale(n?-i.x:i.x,i.y),a(o),o.restore()}drawTile(t,i=h(1),s,n=new b,a,o){this.drawCanvas2D(t,i,a,o,l=>{const r=s&&s.getTextureInfo();r?(l.globalAlpha=n.a,l.drawImage(r.image,s.pos.x,s.pos.y,s.size.x,s.size.y,-.5,-.5,1,1),l.globalAlpha=1):(l.fillStyle=n,l.fillRect(-.5,-.5,1,1))})}drawRect(t,i,s,n){this.drawTile(t,i,void 0,s,n)}}class ys extends ce{constructor(t,i,s=0,n=0,a=100,o=T,l,r=new b,c=new b,f=new b(1,1,1,0),g=new b(1,1,1,0),p=.5,w=.1,d=1,m=.1,v=.05,P=1,L=1,V=0,H=T,k=.1,z=.2,pt=!1,ot=!1,dt=!0,N=ot?1e9:0,xt=!1){super(t,h(),l,i,void 0,N),this.emitSize=s,this.emitTime=n,this.emitRate=a,this.emitConeAngle=o,this.colorStartA=r,this.colorStartB=c,this.colorEndA=f,this.colorEndB=g,this.randomColorLinear=dt,this.particleTime=p,this.sizeStart=w,this.sizeEnd=d,this.speed=m,this.angleSpeed=v,this.damping=P,this.angleDamping=L,this.gravityScale=V,this.particleConeAngle=H,this.fadeRate=k,this.randomness=z,this.collideTiles=pt,this.additive=ot,this.localSpace=xt,this.trailScale=0,this.particleDestroyCallback=void 0,this.particleCreateCallback=void 0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime||this.getAliveTime()<=this.emitTime){if(this.emitRate*ve){const t=1/this.emitRate/ve;for(this.emitTimeBuffer+=Rs;this.emitTimeBuffer>0;this.emitTimeBuffer-=t)this.emitParticle()}}else this.destroy();Et&&It(this.pos,h(this.emitSize),"#0f0",0,this.angle)}emitParticle(){let t=typeof this.emitSize=="number"?Zi(this.emitSize/2):h(I(-.5,.5),I(-.5,.5)).multiply(this.emitSize).rotate(this.angle),i=I(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(t=this.pos.add(t),i+=this.angle);const s=this.randomness,n=m=>m+m*I(s,-s),a=n(this.particleTime),o=n(this.sizeStart),l=n(this.sizeEnd),r=n(this.speed),c=n(this.angleSpeed)*qi(),f=I(this.emitConeAngle,-this.emitConeAngle),g=be(this.colorStartA,this.colorStartB,this.randomColorLinear),p=be(this.colorEndA,this.colorEndB,this.randomColorLinear),w=this.localSpace?f:this.angle+f,d=new ps(t,this.tileInfo,i,g,p,a,o,l,this.fadeRate,this.additive,this.trailScale,this.localSpace&&this,this.particleDestroyCallback);return d.velocity=h().setAngle(w,r),d.angleVelocity=c,d.fadeRate=this.fadeRate,d.damping=this.damping,d.angleDamping=this.angleDamping,d.elasticity=this.elasticity,d.friction=this.friction,d.gravityScale=this.gravityScale,d.collideTiles=this.collideTiles,d.renderOrder=this.renderOrder,d.mirror=!!Me(2),this.particleCreateCallback&&this.particleCreateCallback(d),d}render(){}}class ps extends ce{constructor(t,i,s,n,a,o,l,r,c,f,g,p,w){super(t,h(),i,s),this.colorStart=n,this.colorEndDelta=a.subtract(n),this.lifeTime=o,this.sizeStart=l,this.sizeEndDelta=r-l,this.fadeRate=c,this.additive=f,this.trailScale=g,this.localSpaceEmitter=p,this.destroyCallback=w}render(){const t=J((_-this.spawnTime)/this.lifeTime,1),i=this.sizeStart+t*this.sizeEndDelta,s=h(i),n=this.fadeRate/2,a=new b(this.colorStart.r+t*this.colorEndDelta.r,this.colorStart.g+t*this.colorEndDelta.g,this.colorStart.b+t*this.colorEndDelta.b,(this.colorStart.a+t*this.colorEndDelta.a)*(t<n?t/n:t>1-n?(1-t)/n:1));this.additive&&Je(!0);let o=this.pos,l=this.angle;if(this.localSpaceEmitter&&(o=this.localSpaceEmitter.pos.add(o.rotate(-this.localSpaceEmitter.angle)),l+=this.localSpaceEmitter.angle),this.trailScale){let r=this.velocity;this.localSpaceEmitter&&(r=r.rotate(-this.localSpaceEmitter.angle));const c=r.length();if(c){const f=r.scale(1/c),g=c*this.trailScale;s.y=ut(s.x,g),l=f.angle(),Nt(o.add(f.multiply(h(0,-g/2))),s,this.tileInfo,a,l,this.mirror)}}else Nt(o,s,this.tileInfo,a,l,this.mirror);this.additive&&Je(),Et&&It(o,s,"#f005",0,l),t==1&&(this.color=a,this.size=s,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}const ae=[];let ye=[],qe,ge;function ia(e){qe=e,ae.forEach(t=>t.unlocked=localStorage[t.storageKey()]|0)}class sa{constructor(t,i,s="",n="🏆",a){x(t>=0&&!ae[t]),ae[this.id=t]=this,this.name=i,this.description=s,this.icon=n,a&&((this.image=new Image).src=a)}unlock(){pi||this.unlocked||(x(qe,"save name must be set"),localStorage[this.storageKey()]=this.unlocked=1,ye.push(this),Ae&&Ae.unlockMedal(this.id))}render(t=0){const i=u,s=J(Ft.x,S.width),n=F.width-s,a=-Ft.y*t;i.save(),i.beginPath(),i.fillStyle=new b(.9,.9,.9).toString(),i.strokeStyle=new b(0,0,0).toString(),i.lineWidth=3,i.rect(n,a,s,Ft.y),i.fill(),i.stroke(),i.clip(),this.renderIcon(h(n+15+ee/2,a+Ft.y/2));const o=h(n+ee+30,a+28);_t(this.name,o,38,new b(0,0,0),0,void 0,"left"),o.y+=32,_t(this.description,o,24,new b(0,0,0),0,void 0,"left"),i.restore()}renderIcon(t,i=ee){this.image?u.drawImage(this.image,t.x-i/2,t.y-i/2,i,i):_t(this.icon,t,i*.7,new b(0,0,0))}storageKey(){return qe+"_"+this.id}}function na(){if(!ye.length)return;const e=ye[0],t=Ie-ge;if(!ge)ge=Ie;else if(t>Te)ge=0,ye.shift();else{const i=Te-jt,s=t<jt?1-t/jt:t>i?(t-i)/jt:0;e.render(s)}}let Ae;function aa(e,t,i){Ae=new xs(e,t,i)}class xs{constructor(t,i,s){x(!Ae&&t>0,"there can only be one newgrounds object"),x(!i||s,"must provide cryptojs if there is a cipher"),this.app_id=t,this.cipher=i,this.cryptoJS=s,this.host=location?location.hostname:"";const n=new URL(location.href);if(this.session_id=n.searchParams.get("ngio_session_id"),!this.session_id)return;const a=this.call("Medal.getList");this.medals=a?a.result.data.medals:[];for(const r of this.medals){const c=ae[r.id];c&&(c.image=new Image,c.image.src=r.icon,c.name=r.name,c.description=r.description,c.unlocked=r.unlocked,c.difficulty=r.difficulty,c.value=r.value,c.value&&(c.description=c.description+" ("+c.value+")"))}const o=this.call("ScoreBoard.getBoards");this.scoreboards=o?o.result.data.scoreboards:[];const l=5*60*1e3;setInterval(()=>this.call("Gateway.ping",0,!0),l)}unlockMedal(t){return this.call("Medal.unlock",{id:t},!0)}postScore(t,i){return this.call("ScoreBoard.postScore",{id:t,value:i},!0)}getScores(t,i,s=0,n=0,a=10){return this.call("ScoreBoard.getScores",{id:t,user:i,social:s,skip:n,limit:a})}logView(){return this.call("App.logView",{host:this.host},!0)}call(t,i,s=!1){const n={component:t,parameters:i};if(this.cipher){const c=this.cryptoJS,f=c.enc.Base64.parse(this.cipher),g=c.lib.WordArray.random(16),p=c.AES.encrypt(JSON.stringify(n),f,{iv:g});n.secure=c.enc.Base64.stringify(g.concat(p.ciphertext)),n.parameters=0}const a={app_id:this.app_id,session_id:this.session_id,call:n},o=new FormData;o.append("input",JSON.stringify(a));const l=new XMLHttpRequest;return l.open("POST","https://newgrounds.io/gateway_v3.php",s),l.send(o),l.responseText&&JSON.parse(l.responseText)}}let K,y,pe,Ze,Ss,Ce,Q,Ve,ct,_e,Ee;function oa(){K=document.createElement("canvas"),y=K.getContext("webgl2"),le&&document.body.appendChild(K),pe=Ci(`#version 300 es
precision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}`,`#version 300 es
precision highp float;in vec2 v;in vec4 d,e;uniform sampler2D s;out vec4 c;void main(){c=texture(s,v)*d+e;}`);const e=new ArrayBuffer(Ps);Q=new Float32Array(e),Ve=new Uint32Array(e),Ss=y.createBuffer(),Ce=y.createBuffer();const t=new Float32Array([ct=0,0,1,0,0,1,1,1]);y.bindBuffer(Pt,Ce),y.bufferData(Pt,t,ya)}function ra(){y.viewport(0,0,K.width=S.width,K.height=S.height),y.clear(ma),y.useProgram(pe),y.activeTexture(As),y.bindTexture(mt,Ze=Ht[0].glTexture);let e=_e=Ee=0,t=(n,a,o,l)=>{const r=y.getAttribLocation(pe,n),c=o&&zs,f=o&&1,g=o==1;y.enableVertexAttribArray(r),y.vertexAttribPointer(r,l,a,g,c,e),y.vertexAttribDivisor(r,f),e+=l*o};y.bindBuffer(Pt,Ce),t("g",Zt,0,2),y.bindBuffer(Pt,Ss),y.bufferData(Pt,Ps,pa),t("p",Zt,4,4),t("u",Zt,4,4),t("c",ze,1,4),t("a",ze,1,4),t("r",Zt,4,1);const i=h(2*E).divide(R),s=h(-1).subtract(U.multiply(i));y.uniformMatrix4fv(y.getUniformLocation(pe,"m"),!1,new Float32Array([i.x,0,0,0,0,i.y,0,0,1,1,1,1,s.x,s.y,0,0]))}function bs(e){e!=Ze&&(Ge(),y.bindTexture(mt,Ze=e))}function Qe(e,t){const i=y.createShader(t);if(y.shaderSource(i,e),y.compileShader(i),!y.getShaderParameter(i,ba))throw y.getShaderInfoLog(i);return i}function Ci(e,t){const i=y.createProgram();if(y.attachShader(i,Qe(e,Sa)),y.attachShader(i,Qe(t,xa)),y.linkProgram(i),!y.getProgramParameter(i,wa))throw y.getProgramInfoLog(i);return i}function Ei(e){const t=y.createTexture();y.bindTexture(mt,t),e&&y.texImage2D(mt,0,Pe,Pe,ze,e);const i=re?ua:da;return y.texParameteri(mt,ga,i),y.texParameteri(mt,fa,i),t}function Ge(){if(!ct)return;const e=Ee?Ni:ha;y.blendFuncSeparate(ca,e,Ni,e),y.enable(Ds),y.bufferSubData(Pt,0,Q),y.drawArraysInstanced(Ts,0,4,ct),Rt&&(De+=ct),ct=0,Ee=_e}function Gt(e,t=!1){!ct&&!t||(Ge(),(!le||t)&&e.drawImage(K,0,0))}function Gi(e,t,i,s,n,a,o,l,r,c,f=0){x(typeof c=="number"&&typeof f=="number","invalid color"),(ct>=Es||Ee!=_e)&&Ge();let g=ct*Cs;Q[g++]=e,Q[g++]=t,Q[g++]=i,Q[g++]=s,Q[g++]=a,Q[g++]=o,Q[g++]=l,Q[g++]=r,Ve[g++]=c,Ve[g++]=f,Q[g++]=n,ct++}let Bt,ws,$e;function vs(e,t=!1){x(!Bt,"can only have 1 post effects shader"),e||(e="void mainImage(out vec4 c,vec2 p){c=texture(iChannel0,p/iResolution.xy);}"),Bt=Ci(`#version 300 es
precision highp float;in vec2 p;void main(){gl_Position=vec4(p+p-1.,1,1);}`,`#version 300 es
precision highp float;uniform sampler2D iChannel0;uniform vec3 iResolution;uniform float iTime;out vec4 c;
`+e+`
void main(){mainImage(c,gl_FragCoord.xy);c.a=1.;}`),ws=Ei(void 0),$e=t,S.style.visibility="hidden",$e&&(F.style.visibility="hidden")}function la(){if(!Bt)return;q?(Ge(),A.drawImage(K,0,0)):y.viewport(0,0,K.width=S.width,K.height=S.height),$e&&A.drawImage(F,0,0),y.useProgram(Bt),y.bindBuffer(Pt,Ce),y.pixelStorei(va,1),y.disable(Ds),y.activeTexture(As),y.bindTexture(mt,ws),y.texImage2D(mt,0,Pe,Pe,ze,S);const e=8,t=y.getAttribLocation(Bt,"p");y.enableVertexAttribArray(t),y.vertexAttribPointer(t,2,Zt,!1,e,0);const i=s=>y.getUniformLocation(Bt,s);y.uniform1i(i("iChannel0"),0),y.uniform1f(i("iTime"),_),y.uniform3f(i("iResolution"),S.width,S.height,1),y.drawArrays(Ts,0,4)}const Ni=1,Ts=5,ca=770,ha=771,Ds=3042,mt=3553,ze=5121,Zt=5126,Pe=6408,ua=9728,da=9729,fa=10240,ga=10241,ma=16384,As=33984,Pt=34962,ya=35044,pa=35048,xa=35632,Sa=35633,ba=35713,wa=35714,va=37440,Cs=11,Es=1e4,zs=Cs*4,Ps=Es*zs,Wt="LittleJS",ti="1.9.3",Re=60,Rs=1/Re;let B=[],Is=[],ks=0,_=0,Ie=0,Ut=!1;function Ta(e){Ut=e}let Wi=0,et=0,Ue=0;function Ms(e,t,i,s,n,a=["tiles.png"]){x(Array.isArray(a),"pass in images as array");function o(g=0){let p=g-Wi;Wi=g,Ue=St(.05,Ue,1e3/(p||1));const w=X("Equal"),d=X("Minus");if(p*=w?5:d?.2:1,Ie+=p/1e3,et+=Ut?0:p,w||(et=J(et,50)),l(),Ut)Fi(),ji(),i(),Bi();else{let m=0;for(et<0&&et>-9&&(m=et,et=0);et>=0;et-=1e3/Re)_=ks++/Re,Fi(),t(),Ls(),ji(),i(),Bi();et+=m}Os(),s(),B.sort((m,v)=>m.renderOrder-v.renderOrder);for(const m of B)m.destroyed||m.render();if(n(),la(),na(),Jn(),Zs(),q&&Gt(A),Rt){u.textAlign="right",u.textBaseline="top",u.font="1em monospace",u.fillStyle="#000";const m=Wt+" v"+ti+" / "+De+" / "+B.length+" / "+Ue.toFixed(1)+(q?" GL":" 2D");u.fillText(m,S.width-3,3),u.fillStyle="#fff",u.fillText(m,S.width-2,2),De=0}requestAnimationFrame(o)}function l(){if($t.x){S.width=$t.x,S.height=$t.y;const g=innerWidth/innerHeight,p=S.width/S.height;(K||S).style.width=S.style.width=F.style.width=g<p?"100%":"",(K||S).style.height=S.style.height=F.style.height=g<p?"":"100%"}else S.width=J(innerWidth,we.x),S.height=J(innerHeight,we.y);F.width=S.width,F.height=S.height,R=h(S.width,S.height)}const r="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none";document.body.style.cssText=r,document.body.appendChild(S=document.createElement("canvas")),A=S.getContext("2d"),qs(),q&&oa(),document.body.appendChild(F=document.createElement("canvas")),u=F.getContext("2d");const c="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";(K||S).style.cssText=S.style.cssText=F.style.cssText=c,l();const f=a.map((g,p)=>new Promise(w=>{const d=new Image;d.onerror=d.onload=()=>{Ht[p]=new ss(d),w()},d.src=g}));ai&&f.push(new Promise(g=>{let p=0;console.log(`${Wt} Engine v${ti}`),w();function w(){bi(),Ca(p+=.01),p>1?g():setTimeout(w,16)}})),Promise.all(f).then(()=>{e(),o()})}function Os(){R=h(S.width,S.height),A.imageSmoothingEnabled=!re,q&&ra()}function Ls(){Is=B.filter(t=>t.collideSolidObjects);function e(t){if(!t.destroyed){t.update();for(const i of t.children)e(i)}}for(const t of B)t.parent||e(t);B=B.filter(t=>!t.destroyed)}function Da(){for(const e of B)e.parent||e.destroy();B=B.filter(e=>!e.destroyed)}function Aa(e,t,i,s=B){if(e)if(typeof t=="object")for(const n of s)Se(e,t,n.pos,n.size)&&i(n);else{const n=t*t;for(const a of s)e.distanceSquared(a.pos)<n&&i(a)}else for(const n of s)i(n)}function Ca(e){const t=u,i=F.width=innerWidth,s=F.height=innerHeight;{const d=Y(e,1,.8),m=Y(e,0,.5),v=t.createRadialGradient(i/2,s/2,0,i/2,s/2,Math.hypot(i,s)*.7);v.addColorStop(0,lt(0,0,St(m,0,d/2),d).toString()),v.addColorStop(1,lt(0,0,0,d).toString()),t.save(),t.fillStyle=v,t.fillRect(0,0,i,s)}const n=(d,m,v,P,L)=>{t.beginPath(),t.rect(d,m,v,L?P*c:P),t.fillStyle=L,L?t.fill():t.stroke()},a=(d,m,v,P)=>{t.beginPath(),t.lineTo(d,m),t.lineTo(v,P),t.stroke()},o=(d,m,v,P=0,L=2*T,V,H)=>{const k=(P+L)/2,z=c*(L-P)/2;t.beginPath(),H&&t.lineTo(d,m),t.arc(d,m,v,k-z,k+z),t.fillStyle=V,V?t.fill():t.stroke()},l=(d=0,m=0)=>lt([.98,.3,.57,.14][d%4]-10,.8,[0,.3,.5,.8,.9][m]).toString(),r=Yi(1,1,e),c=Y(r,.1,.5);t.translate(i/2,s/2);const f=J(6,J(i,s)/99);t.scale(f,f),t.translate(-40,-35),t.lineJoin=t.lineCap="round",t.lineWidth=.1+c*1.9;const g=Y(r,.1,1);t.setLineDash([99*g,99]),n(7,17,18,-8,l(2,2)),n(7,9,18,4,l(2,3)),n(25,9,8,8,l(2,1)),n(25,9,-18,8),n(25,9,8,8),n(25,17,7,22,l()),n(11,40,14,-23,l(1,1)),n(11,17,14,17,l(1,2)),n(11,17,14,9,l(1,3)),n(15,31,6,-9,l(2,2)),o(15,23,5,0,T/2,l(2,4),1),n(25,17,-14,23),n(21,22,-6,9),n(37,14,9,6,l(3,2)),n(37,14,4.5,6,l(3,3)),n(37,14,9,6),n(50,20,10,-10,l(0,1)),n(50,20,6.5,-10,l(0,2)),n(50,20,3.5,-10,l(0,3)),n(50,20,10,-10),o(55,2,11.4,.5,T-.5,l(3,3)),o(55,2,11.4,.5,T/2,l(3,2),1),o(55,2,11.4,.5,T-.5),n(45,7,20,-7,l(0,2)),n(45,0,20,3,l(0,3)),n(45,0,20,7);for(let d=5;d--;)o(60-d*6,30,9.9,0,2*T,l(d+2,3)),o(60-d*6,30,10,-.5,T+.5,l(d+2,2)),o(60-d*6,30,10.1,.5,T-.5,l(d+2,1));o(36,30,10,T/2,T*3/2),o(48,30,10,T/2,T*3/2),o(60,30,10),a(36,20,60,20),o(60,30,4,T,3*T,l(3,2)),o(60,30,4,T,2*T,l(3,3)),o(60,30,4,T,3*T);for(let d=6;d--;)t.beginPath(),t.lineTo(53,54),t.lineTo(53,40),t.lineTo(53+(1+d*2.9)*c,40),t.lineTo(53+(4+d*3.5)*c,54),t.fillStyle=l(0,d%2+2),t.fill(),d%2&&t.stroke();n(6,40,5,5),n(6,40,5,5,l()),n(15,54,38,-14,l());for(let d=3;d--;)for(let m=2;m--;)o(15*d+15,47,m?7:1,T,3*T,l(d,3)),t.stroke(),o(15*d+15,47,m?7:1,0,T,l(d,2)),t.stroke();a(6,40,68,40),a(77,54,4,54);const p=Wt;t.font="900 16px arial",t.textAlign="center",t.textBaseline="top",t.lineWidth=.1+c*3.9;let w=0;for(let d=0;d<p.length;++d)w+=t.measureText(p[d]).width;for(let d=2;d--;)for(let m=0,v=41-w/2;m<p.length;++m){t.fillStyle=l(m,2);const P=t.measureText(p[m]).width;t[d?"strokeText":"fillText"](p[m],v+P/2,55.5,17*c),v+=P}t.restore()}const Ea=Object.freeze(Object.defineProperty({__proto__:null,ASSERT:x,Color:b,EngineObject:ce,FontImage:Gn,Medal:sa,Music:Zn,Newgrounds:xs,PI:T,Particle:ps,ParticleEmitter:ys,RandomGenerator:sn,Sound:Be,SoundWave:qn,TextureInfo:ss,TileInfo:Fe,TileLayer:ms,TileLayerData:Ai,Timer:oe,Vector2:M,abs:G,audioContext:$,get cameraPos(){return U},get cameraScale(){return E},get canvasFixedSize(){return $t},get canvasMaxSize(){return we},get canvasPixelated(){return re},clamp:D,clearInput:bi,debug:Hs,debugAABB:Xe,debugCircle:He,debugClear:Ys,debugLine:xe,get debugOverlay(){return yt},debugPoint:ei,debugRect:It,debugSaveCanvas:Hi,debugText:Ki,distanceAngle:Qs,distanceWrap:ii,drawCanvas2D:ns,drawLine:Ye,drawRect:wt,drawText:_n,drawTextScreen:_t,drawTile:Nt,get enablePhysicsSolver(){return oi},get engineFontImage(){return me},engineInit:Ms,engineName:Wt,get engineObjects(){return B},engineObjectsCallback:Aa,engineObjectsDestroy:Da,engineObjectsUpdate:Ls,engineVersion:ti,get fontDefault(){return ni},formatTime:Ji,get frame(){return ks},frameRate:Re,get gamepadDirectionEmulateStick(){return di},gamepadIsDown:rt,gamepadStick:ls,gamepadWasPressed:rs,gamepadWasReleased:Hn,get gamepadsEnable(){return Le},gamepadsUpdate:cs,getNoteFrequency:ta,getTileCollisionData:Di,get glCanvas(){return K},glCompileShader:Qe,get glContext(){return y},glCreateProgram:Ci,glCreateTexture:Ei,get glEnable(){return q},glInitPostProcess:vs,get glOverlay(){return le},glSetTexture:bs,get gravity(){return Lt},hsl:lt,initTileCollision:ds,get inputWASDEmulateDirection(){return te},isFullscreen:as,isOverlapping:Se,isTouchDevice:ue,get isUsingGamepad(){return nt},keyIsDown:X,keyWasPressed:it,keyWasReleased:Si,lerp:St,lerpAngle:$s,lerpWrap:Xi,get mainCanvas(){return S},get mainCanvasSize(){return R},get mainContext(){return A},max:ut,get medalDisplayIconSize(){return ee},get medalDisplaySize(){return Ft},get medalDisplaySlideTime(){return jt},get medalDisplayTime(){return Te},medals:ae,medalsInit:ia,get medalsPreventUnlock(){return pi},min:J,mod:Vs,mouseIsDown:Nn,get mousePos(){return ft},get mousePosScreen(){return Xt},mouseToScreen:he,mouseWasPressed:Wn,mouseWasReleased:Un,get mouseWheel(){return wi},nearestPowerOfTwo:en,newgroundsInit:aa,get objectDefaultAngleDamping(){return ci},get objectDefaultDamping(){return li},get objectDefaultElasticity(){return hi},get objectDefaultFriction(){return ui},get objectDefaultMass(){return ri},get objectMaxSpeed(){return Ot},get overlayCanvas(){return F},get overlayContext(){return u},get particleEmitRateScale(){return ve},get paused(){return Ut},percent:Y,playAudioFile:Vn,playSamples:vi,preventDefaultInput:Kn,rand:I,randColor:be,randInCircle:Zi,randInt:Me,randSign:qi,randVector:si,rgb:nn,screenToWorld:xi,setBlendMode:Je,setCameraPos:Vi,setCameraScale:Qi,setCanvasFixedSize:$i,setCanvasMaxSize:an,setCanvasPixelated:on,setDebugKey:Fn,setEnablePhysicsSolver:fn,setFontDefault:rn,setGamepadDirectionEmulateStick:Tn,setGamepadsEnable:vn,setGlEnable:cn,setGlOverlay:hn,setGravity:bn,setInputWASDEmulateDirection:Dn,setMedalDisplayIconSize:Ln,setMedalDisplaySize:On,setMedalDisplaySlideTime:Mn,setMedalDisplayTime:kn,setMedalsPreventUnlock:jn,setObjectDefaultAngleDamping:yn,setObjectDefaultDamping:mn,setObjectDefaultElasticity:pn,setObjectDefaultFriction:xn,setObjectDefaultMass:gn,setObjectMaxSpeed:Sn,setParticleEmitRateScale:wn,setPaused:Ta,setShowSplashScreen:ln,setShowWatermark:is,setSoundDefaultRange:Rn,setSoundDefaultTaper:In,setSoundEnable:zn,setSoundVolume:Pn,setTileCollisionData:fs,setTileFixBleedScale:dn,setTileSizeDefault:un,setTouchGamepadAlpha:Cn,setTouchGamepadAnalog:An,setTouchGamepadEnable:ts,setTouchGamepadSize:es,setVibrateEnable:En,get showSplashScreen(){return ai},get showWatermark(){return Rt},sign:ht,smoothStep:tn,get soundDefaultRange(){return mi},get soundDefaultTaper(){return yi},get soundEnable(){return at},get soundVolume(){return Kt},speak:Qn,speakStop:$n,textureInfos:Ht,tile:se,get tileCollision(){return zt},tileCollisionRaycast:gs,get tileCollisionSize(){return Z},tileCollisionTest:qt,get tileFixBleedScale(){return bt},get tileSizeDefault(){return Oe},get time(){return _},timeDelta:Rs,get timeReal(){return Ie},toggleFullscreen:os,get touchGamepadAlpha(){return fi},get touchGamepadAnalog(){return je},get touchGamepadEnable(){return ie},get touchGamepadSize(){return O},vec2:h,vibrate:hs,get vibrateEnable(){return gi},vibrateStop:Xn,wave:Yi,worldToScreen:kt,zzfx:us},Symbol.toStringTag,{value:"Module"})),{vec2:st}=Ea,za=new Be([1,.5]);is(!1);Ms(Pa,Ra,Ia,ka,Ma);let ke;function Pa(){$i(st(1920,1080)),Qi(100),ue&&(ts(!0),es(300));const e=st(32,32);ds(e),ke=new La,ke.pos=Z.divide(st(2,2));const t=st(),i=new ms(t,e),s=Ht[0].image;A.drawImage(s,0,0);const n=A.getImageData(0,0,s.width,s.height).data;for(t.x=e.x;t.x--;)for(t.y=e.y;t.y--;){const a=t.x+s.width*(15+e.y-t.y);if(!n[4*a])continue;const o=1,l=Me(4),r=be(),c=new Ai(o,l,!1,r);i.setData(t,c),fs(t,1)}i.redraw(),Oa()}function Ra(){rs(3)&&os();const e=R.scale(1/E);Vi(st(D(ke.pos.x,0+e.x/2,32-e.x/2),D(ke.pos.y,0+e.y/2,32-e.y/2)))}function Ia(){}function ka(){for(let e=0;e<32;e++)for(let t=0;t<32;t++)wt(st(e-.5,t-.5),st(1,1),lt(0,0,(e+t)%2==0?.8:.9),void 0,!1)}function Ma(){}function Oa(){vs(`
    // Simple TV Shader Code
    float hash(vec2 p)
    {
        p=fract(p*.3197);
        return fract(1.+sin(51.*p.x+73.*p.y)*13753.3);
    }
    float noise(vec2 p)
    {
        vec2 i=floor(p),f=fract(p),u=f*f*(3.-2.*f);
        return mix(mix(hash(i),hash(i+vec2(1,0)),u.x),mix(hash(i+vec2(0,1)),hash(i+1.),u.x),u.y);
    }
    void mainImage(out vec4 c, vec2 p)
    {
        // put uv in texture pixel space
        p /= iResolution.xy;

        // apply fuzz as horizontal offset
        const float fuzz = .0005;
        const float fuzzScale = 800.;
        const float fuzzSpeed = 9.;
        p.x += fuzz*(noise(vec2(p.y*fuzzScale, iTime*fuzzSpeed))*2.-1.);

        // init output color
        c = texture(iChannel0, p);

        // chromatic aberration
        const float chromatic = .002;
        c.r = texture(iChannel0, p - vec2(chromatic,0)).r;
        c.b = texture(iChannel0, p + vec2(chromatic,0)).b;

        // tv static noise
        const float staticNoise = .1;
        c += staticNoise * hash(p + mod(iTime, 1e3));

        // scan lines
        const float scanlineScale = 1e3;
        const float scanlineAlpha = .1;
        c *= 1. + scanlineAlpha*sin(p.y*scanlineScale);

        // black vignette around edges
        const float vignette = 2.;
        const float vignettePow = 6.;
        float dx = 2.*p.x-1., dy = 2.*p.y-1.;
        c *= 1.-pow((dx*dx + dy*dy)/vignette, vignettePow);
    }`,!1)}class La extends ce{constructor(){super();Li(this,"particleEmitter");this.size=st(.8,.8),this.setCollision(!1,!1,!0),this.tileInfo=se(2),this.particleEmitter=new ys(st(16,9),0,1,0,500,Math.PI,se(0,16),lt(1,1,1),lt(0,0,0),lt(0,0,0,0),lt(0,0,0,0),2,.2,.2,.1,.05,.99,1,1,Math.PI,.05,.5,!0,!0),this.particleEmitter.elasticity=.3,this.particleEmitter.trailScale=2,this.particleEmitter.emitTime=1e3}update(){nt?document.body.requestPointerLock():document.exitPointerLock();const i=nt?ls(0):st(X("KeyD")-X("KeyA"),X("KeyW")-X("KeyS"));this.velocity=i.clampLength(.1),this.velocity.x>0?this.mirror=!1:this.velocity.x<0&&(this.mirror=!0),X("Space")||nt&&rt(1)?(za.play(this.pos),this.velocity=this.velocity.scale(3),this.particleEmitter.emitRate=500):this.particleEmitter.emitRate=0,this.particleEmitter.pos=this.pos,super.update()}}
